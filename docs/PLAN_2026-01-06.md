# Plan for 2026-01-06

**Date:** 2026-01-06
**Prepared:** 2026-01-05 (Evening)
**Total Duration:** 8-10 hours
**Sessions:** 3

---

## Overview

Три сессии с фокусом на завершение MVP функционала и подготовку к тестированию:

1. **Session 1 (2-3h):** Saved Filter Views — отложенное с 2026-01-05
2. **Session 2 (3-4h):** Project Members — управление участниками проекта
3. **Session 3 (3-4h):** Dashboard & Notifications UI — визуальная часть

**Параллельно:** Тестирование и багфиксы по результатам.

---

## Session 1: Saved Filter Views (2-3h)

### Goal
Реализовать сохранение и загрузку фильтров (отложено с 2026-01-05).

### Tasks

#### 1.1 Backend: UserView Model (1h)

**Create `backend/app/modules/views/`:**

```python
# models.py
class UserView(Base):
    id: UUID
    user_id: UUID (FK)
    name: str  # "Мои задачи", "Срочные", etc.
    entity_type: str  # "task", "project"
    filters_json: dict  # JSONB with filter config
    is_default: bool
    position: int
    created_at, updated_at

# schemas.py
class UserViewCreate(BaseModel):
    name: str
    entity_type: str
    filters: dict
    is_default: bool = False

class UserViewResponse(BaseModel):
    id: UUID
    name: str
    entity_type: str
    filters: dict
    is_default: bool
    created_at: datetime
```

**Endpoints:**
- `GET /views?entity_type=task` — список представлений
- `POST /views` — создать
- `PATCH /views/{id}` — обновить
- `DELETE /views/{id}` — удалить
- `POST /views/{id}/apply` — применить (опционально)

**Files:**
- `backend/app/modules/views/__init__.py`
- `backend/app/modules/views/models.py`
- `backend/app/modules/views/schemas.py`
- `backend/app/modules/views/service.py`
- `backend/app/modules/views/router.py`
- `alembic/versions/*_create_user_views.py`

---

#### 1.2 Frontend: Views Module (1-1.5h)

**Tasks:**
- [ ] Create `frontend/src/modules/views/types.ts`
- [ ] Create `frontend/src/modules/views/api.ts`
- [ ] Create `frontend/src/modules/views/hooks/useViews.ts`

**Components:**
- [ ] `SaveViewModal` — модал для сохранения текущих фильтров
- [ ] `ViewSelector` — dropdown для выбора сохраненного представления

**Integration:**
- [ ] Add "Сохранить как..." button to TaskFilters
- [ ] Add ViewSelector to TasksPage header
- [ ] Load filters from selected view

---

#### 1.3 Tests (0.5h)

- [ ] Backend: 8-10 test scenarios
- [ ] Manual frontend testing

---

## Session 2: Project Members Management (3-4h)

### Goal
Полноценное управление участниками проекта с ролями.

### Tasks

#### 2.1 Backend Enhancements (1h)

**Review existing:**
- `GET /projects/{id}/members` — уже есть
- `POST /projects/{id}/members` — уже есть
- `PATCH /projects/{id}/members/{user_id}` — уже есть
- `DELETE /projects/{id}/members/{user_id}` — уже есть

**Add if missing:**
- [ ] Role-based permissions check (owner > admin > member > viewer)
- [ ] Prevent removing last owner
- [ ] Prevent self-demotion from owner
- [ ] Add `can_*` helper methods to ProjectService

---

#### 2.2 Frontend: ProjectMembersTab Enhancement (1.5h)

**Current state:** Базовый tab есть, нужно улучшить

**Enhancements:**
- [ ] Добавить UserSelect для поиска и добавления пользователей
- [ ] Role dropdown для изменения роли
- [ ] Confirmation dialog для удаления
- [ ] Показывать owner badge (нельзя удалить/изменить)
- [ ] Disable actions для viewer роли
- [ ] Empty state с "Добавить участника" CTA

**Files:**
- `frontend/src/modules/projects/components/ProjectMembersTab.tsx`
- `frontend/src/modules/users/components/UserSelect.tsx` (если нет)

---

#### 2.3 Frontend: Invite Flow (1h)

**Simple flow for MVP:**
- [ ] "Пригласить" button opens modal
- [ ] Search users by name/email
- [ ] Select role
- [ ] Add to project

**Files:**
- `frontend/src/modules/projects/components/InviteMemberModal.tsx`

---

#### 2.4 Tests & Polish (0.5h)

- [ ] Test all CRUD operations for members
- [ ] Test role restrictions
- [ ] Fix any UI issues found

---

## Session 3: Dashboard & Notifications UI (3-4h)

### Goal
Создать Dashboard и базовый UI для уведомлений.

### Tasks

#### 3.1 Dashboard Page (2h)

**Layout:**
```
┌─────────────────────────────────────────────────────────┐
│  Добро пожаловать, {userName}!                          │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐     │
│  │ Мои задачи   │ │ На проверке  │ │ Просрочено   │     │
│  │     12       │ │      3       │ │      2       │     │
│  └──────────────┘ └──────────────┘ └──────────────┘     │
├─────────────────────────────────────────────────────────┤
│  Недавние задачи            Мои проекты                 │
│  ┌─────────────────────┐    ┌─────────────────────┐     │
│  │ Task 1 - В работе   │    │ Project A - 67%    │     │
│  │ Task 2 - Новая      │    │ Project B - 45%    │     │
│  │ Task 3 - На проверке│    │ Project C - 12%    │     │
│  └─────────────────────┘    └─────────────────────┘     │
└─────────────────────────────────────────────────────────┘
```

**Components:**
- [ ] `DashboardPage.tsx` — main page
- [ ] `StatCard.tsx` — статистика (число + label)
- [ ] `RecentTasksList.tsx` — последние задачи пользователя
- [ ] `MyProjectsList.tsx` — проекты пользователя

**Data:**
- [ ] `GET /users/me/stats` — статистика (можно добавить endpoint или собирать из существующих)
- [ ] `GET /tasks?assignee_id=me&limit=5` — недавние задачи
- [ ] `GET /projects?member_id=me&limit=5` — мои проекты

---

#### 3.2 Notifications UI (1.5h)

**Backend exists:**
- `GET /notifications` — список
- `GET /notifications/unread/count` — счетчик
- `POST /notifications/{id}/read` — отметить прочитанным
- `POST /notifications/read-all` — отметить все

**Frontend tasks:**
- [ ] `NotificationBell.tsx` — иконка в header с badge (unread count)
- [ ] `NotificationsDropdown.tsx` — dropdown со списком
- [ ] `NotificationItem.tsx` — один notification
- [ ] Click → navigate to related entity (task, project, etc.)
- [ ] "Отметить все прочитанными" button

**Files:**
- `frontend/src/modules/notifications/types.ts`
- `frontend/src/modules/notifications/api.ts`
- `frontend/src/modules/notifications/hooks/useNotifications.ts`
- `frontend/src/modules/notifications/components/NotificationBell.tsx`
- `frontend/src/modules/notifications/components/NotificationsDropdown.tsx`

---

#### 3.3 Integration (0.5h)

- [ ] Add Dashboard as default route (/)
- [ ] Add NotificationBell to Header
- [ ] Update Sidebar: Dashboard link at top
- [ ] Test notification flow

---

## Success Criteria

### Session 1
- [ ] Можно сохранить текущие фильтры как "представление"
- [ ] Можно загрузить сохраненное представление
- [ ] Представления персональные (per user)
- [ ] Backend tests pass

### Session 2
- [ ] Можно добавить участника в проект с ролью
- [ ] Можно изменить роль участника
- [ ] Можно удалить участника (кроме owner)
- [ ] Owner нельзя удалить или понизить

### Session 3
- [ ] Dashboard показывает статистику и последние данные
- [ ] Уведомления видны в header
- [ ] Можно открыть dropdown с уведомлениями
- [ ] Можно отметить уведомление прочитанным

---

## Deferred to Post-MVP

- [ ] Global search (full-text)
- [ ] Gantt Chart
- [ ] AI SMART validation UI
- [ ] AI Dialog panel
- [ ] Email notifications
- [ ] Export to Excel (частично готов backend)
- [ ] Sorting persistence in URL

---

## Quick Start

```bash
# Start services
cd /home/user/projects/SmartTask360
docker-compose up -d

# Check logs
docker-compose logs -f backend

# Frontend dev
cd frontend
npm run dev
```

---

## Notes

- Фокус на завершение core функционала
- Багфиксы по мере обнаружения
- Тестирование параллельно с разработкой
- После этого дня — полировка и AI UI

---

**Good luck!**
